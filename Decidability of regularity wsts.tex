\documentclass[a4paper,final]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}

\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{xspace}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{dsfont}
\usepackage{array}
\usepackage[french]{algorithm2e}
\usepackage{stmaryrd}
\usepackage[normalem]{ulem}

\usepackage{geometry}
\geometry{hmargin=3cm,vmargin=2cm}

\theoremstyle{definition}
\newtheorem{Theorem}{Théorème}
\newtheorem{Definition}[Theorem]{Définition}
\newtheorem{Question}[Theorem]{Question}
\newtheorem{Proposition}[Theorem]{Proposition}
\newtheorem{Lemma}[Theorem]{Lemme}
\newtheorem{Property}[Theorem]{Propriété}
\newtheorem{Example}[Theorem]{Exemple}
%\newtheorem{Proof}{Preuve}

\let\oldphi\phi
\let\phi\varphi
\let\oldepsilon\epsilon
\let\epsilon\varepsilon
\let\leq\leqslant
\let\geq\geqslant

%================================================================

\newcommand{\alain}[1]{\textcolor{blue}{#1}}
\newcommand{\lucas}[1]{\textcolor{olive}{#1}}
\newcommand{\rayer}[1]{\textcolor{red}{#1}}
% \sout pour rayer

\newcommand{\set}[2]{\left\{#1\mathrel{\left|\vphantom{#1}\vphantom{#2}\right.}#2\right\}}
\newcommand{\os}[1]{\left\{\mathinner{#1}\right\}}
\newcommand{\defeq}{\ensuremath{\stackrel{\textit{def}}{=}}}
\let\union\cup
\let\inter\cap

\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Z}{\ensuremath{\mathbb{Z}}}
\newcommand{\Nomega}{\ensuremath{\mathbb{N}_\omega}}
\newcommand{\indicatrice}[1]{\ensuremath{\mathds{1}_{#1}}}

\newcommand{\petri}{réseau de Petri\xspace}
\newcommand{\fire}[2]{\ensuremath{#1 (#2\rangle}}
\newcommand{\lang}{\ensuremath{\mathcal{L}}}
\newcommand{\conf}{\ensuremath{\mathcal{R}}}
\newcommand{\trans}[2]{\ensuremath{\stackrel{#1}{\longrightarrow}_{#2}}}
\newcommand{\vect}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\action}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\rel}{\ensuremath{\equiv}}
\newcommand{\relGY}{\ensuremath{\equiv_\text{GY}}}
\newcommand{\ssi}{\ensuremath{\text{ ssi }}}
\newcommand{\equivaut}{\ensuremath{\Leftrightarrow}}
\newcommand{\xinit}{\ensuremath{\vect{x}_\text{init}}}
\newcommand{\valeur}[1]{\ensuremath{\overline{#1}}}

%================================================================

\title{Décidabilité de la rationnalité pour les WSTS}
\author{Lucas \textsc{Bueri}}
\date{Stage M2 - 2021}

\begin{document}

\maketitle

%================================================================

\section{Réseaux de Petri}

Un \petri $N = (P,T,B,F,M_0)$ est la donnée de
\begin{itemize}
    \item un ensemble fini $P$ de $d$ emplacements,
    \item un ensemble fini $T$ de transitions,
    \item une fonction de coût $B: P\times T\to\N$,
    \item une fonction de production $F: P\times T\to\N$,
    \item un marquage initial $M_0: P\to\N$.
\end{itemize}

Les configurations sont les marquages $M: P\to\N$, aussi considérés comme les valeurs possibles de $d$ compteurs (vecteur de $\N^d$).
On peut déclencher la transition $t$ à partir du marquage $M$ si et
seulement si $M(p)\geq B(p,t)$ pour tout $p\in P$ (noté $M\geq B(\cdot,t)$).

On obtient alors un nouveau marquage $M'$ défini par $M':=M+D(\cdot,t)$ où $D\defeq F-B$. 
$B$ représente donc le coût de la transition (le nombre de jetons requis et consommés dans chaque emplacement), et $F$ représente sa production (les jetons créés lors du déclenchement).

On notera $\fire{M}{t}$ lorsque $t$ peut se déclencher sur $M$, et $\fire{M}{t}M'$ si déclencher $t$ sur $M$ donne $M'$.
On étendra naturellement cette notation (ainsi que $B(p,\cdot)$ et $F(p,\cdot)$) aux séquences de transitions, ou mots $w\in T^\ast$.

Deux ensembles nous intéresseront alors : le langage $\lang(N)\defeq \set{w\in T^\ast} {\fire{M_0}{w}}$ du \petri et les configurations accessibles $\conf(N)\defeq \set{M':P\to\N}{\exists w\in T^\ast, \fire{M_0}{w}M'}$.

%----------------------------------------------------------------

\section{VAS}

Un \emph{système d'addition de vecteurs de dimension} $d\in\N$ ($d-$VAS) $S=(A,\xinit)$ est la donnée d'un vecteur initial $\xinit\in\N^d$ et d'un ensemble fini $A$ d'\emph{actions}.
À chaque action $a\in A$ est associé un unique vecteur $\valeur{a}\in \Z^d$, de telle manière à ce que deux actions ne soient pas associées au même vecteur de $\Z^d$.
\vspace{3mm}
% On pourra préciser ce qu'il se passe si deux actions sont étiquetés par le même vecteur.

Les \emph{configurations} de $S$ sont alors les vecteurs de $\N^d$ (à coordonnées positives), 
et chaque action $a\in A$ agit sur $\N^d$ en additionnant à la configuration courante le vecteur $\valeur{a}$ associé.
On a alors une transition entre $\vect{x}$ et $\vect{y}$ étiquetée par l'action $a$ lorsque $\vect{x} + \valeur{a} = \vect{y}$.

De manière équivalente, on dira que l'action $a\in A$ est \emph{franchissable} 
à partir de la configuration $\vect{x}\in \N^d$ lorsque $\vect{x} + \valeur{a} \geq \vect{0}$,
et son déclenchement aboutit à la configuration $\vect{y} := \vect{x} + \valeur{a}$ à travers la transition $(\vect{x},a,\vect{y})\in \N^d\times A\times \N^d$.
On notera $\vect{x}\trans{a}{S} \vect{y}$ lorsqu'un tel déclenchement est possible (ou simplement $\vect{x}\trans{a}{} \vect{y}$ s'il n'y a pas ambiguité sur $S$).
\vspace{3mm}

Lorsqu'une séquence d'actions $w= a_1\cdots a_k\in A^\ast$ permet d'aller de $\vect{x}$ à $\vect{y}$ par la séquence de transition $\vect{x}= \vect{x_0}\trans{a_1}{} \vect{x_1}\trans{a_2}{} \dots\trans{a_k}{} \vect{x_k}=\vect{y}$
(où $\vect{x_0},\dots,\vect{x_k} \in\N^d$ et $\vect{x_{i-1}} +\valeur{a_i} =\vect{x_i}$ pour tout $1\leq i\leq k$),
on dit que $w$ est franchissable à partir de $\vect{x}$, et qu'on a une \emph{exécution} $\rho :\vect{x}\trans{w}{S} \vect{y}$.
$\vect{y}$ est alors dit accessible à partir de $\vect{x}$.

De plus, en notant $\valeur{w}\defeq \sum^k_{i=1} \valeur{a_i}$ le vecteur associé à $w$, on obtient $\vect{x} +\valeur{w} = \vect{y}$.
Attention, cette égalité peut-être vérifiée même si $w$ n'est pas franchissable.
\vspace{3mm}

Nous allons étudier deux ensembles naturellement associés à un VAS $S=(A,\xinit)$ :
\begin{enumerate}
    \item 
    $\lang(A,\vect{x})\defeq \set{w\in A^\ast} {\exists \vect{y}\in\N^d, \vect{x}\trans{w}{S}\vect{y}}$ qui est le \emph{langage} des séquences d'actions franchissables à partir de la configuration $\vect{x}$,
    
    \item $\conf(A,\vect{x})\defeq \set{\vect{y}\in\N^d} {\exists w\in A^\ast, \vect{x}\trans{w}{S} \vect{y}}$ qui est l'ensemble des configurations \emph{accessibles} à partir de $\vect{x}$. 
\end{enumerate}

En particulier, on regardera $\lang(S):=\lang(A,\xinit)$ le langage du VAS $S$, et $\conf(S):=\conf(A,\xinit)$ l'ensemble d'accessibilité de $S$.

% A déplacer ?
\begin{Definition}
Un VAS $S$ est \emph{rationnel} si $\lang(S)$ est rationnel sur $A^\ast$.
\end{Definition}
%----------------------------------------------------------------

\section{Un algorithme de calcul du Graphe de couverture (pour les VAS)}

On étend les configurations des VAS aux vecteurs à coordonnées dans $\Nomega\defeq \N\union\os{\omega}$.
Cela va nous permettre de représenter le graphe des configurations accessibles de manière finie (bien qu'il puisse exister une infinité de configurations accessibles).

Le \emph{graphe de couverture} \lucas{À revoir.}
a pour sommets des configurations de $\Nomega^d$ et pour arêtes des transitions du VAS, étiquetés par une action de $A$.
Il est obtenu en partant d'un sommet initial $s_0:\xinit$ étiqueté par la configuration initiale $\xinit\in \N^d$, puis par récurrence sur la profondeur des noeuds en indiquant les voisins des noeuds accessibles :

Pour chaque noeud $s:\vect{x}$ associé à la configuration $\vect{x}\in \Nomega^d$, on fait partir de $s$ autant d'arêtes que d'actions $a\in A$ qui sont franchissables à partir de $\vect{x}$.
Le sommet d'arrivée de l'arête associée à une action $a$ est déterminé ainsi :
\begin{itemize}
    \item Si $\vect{x}\trans{a}{} \vect{y}$ (déclencher $a$ aboutit à la configuration $\vect{y} := \vect{x} + \valeur{a}$) 
    et qu'il existe un sommet déjà existant $r:\vect{y}$ associé à cette configuration, alors on crée une arête étiquetée par $a$ de $s:\vect{x}$ vers $r:\vect{y}$ ;
    \item Si $\vect{x}\trans{a}{} \vect{y}$ et qu'il existe un ancêtre $r:\vect{z}$ de $s$ (c'est-à-dire tel qu'il existe une chemin dans le graphe déjà créé de $r$ à $s$) avec $\vect{y}>\vect{z}$, 
    alors on crée un nouveau sommet $s':\vect{y'}$ et une arête de $s:\vect{y}$ vers $s':\vect{y'}$ étiquetée par $a$, 
    où $\vect{y'}\in \Nomega^d$ est la configuration de coordonnées $\vect{y'}(i):=\vect{y}(i)$ pour les $1\leq i\leq d$ tels que $\vect{y}(i)=\vect{z}(i)$, et $\vect{y'}(i):=\omega$ si $\vect{y}(i)>\vect{z}(i)$ ;
    \item Si la configuration $\vect{y}$ atteinte n'est pas dans les cas précédents, on crée simplement un nouveau sommet $s':\vect{y}$ et une arête de $s$ à $s'$ étiquetée par $a$.
\end{itemize}

%----------------------------------------------------------------

\section{Une caractérisation pour la rationnalité}

La preuve de décidabilité se divise en deux étapes.
Tout d'abord, on va donner une caractérisation mathématique équivalente à la rationnalité.
On montrera ainsi qu'un VAS est rationnel si et seulement s'il existe une borne $k\in\N$ telle que si on peut accéder à la configuration $\vect{x}$, puis à $\vect{y}$, alors $\vect{y}$ reste au dessus de $\vect{x}-\vect{k}$.
%ssi il existe une borne sur la décroissance possible des coordonnées des configurations.

\subsection{Une relation sur les configurations}

Ginzburg et Yoeli proposent dans \cite{giyo80} une relation d'équivalence sur les configurations :

\begin{Definition}[\cite{giyo80} section 3]
Soit $S=(A,\xinit)$ un VAS. On définit une relation d'équivalence $\relGY$ sur l'ensemble des configurations accessibles $\conf(S)$ par
$$\forall \vect{x},\vect{y}\in\conf(S), \Big(
\vect{x}\relGY\vect{y} \ssi \forall w\in A^\ast, \big( \vect{x} +\valeur{w}\in\conf(S) \equivaut \vect{y} +\valeur{w}\in\conf(S) \big) \Big)$$
\end{Definition}

On aurait envie d'obtenir un résultat similaire à celui de Nérode, à savoir dire que $\lang(S)$ est rationnel si et seulement si $\relGY$ admet un nombre fini de classes d'équivalence.
Cela est malheureusement faux, puisque pour $\vect{x}\in\conf(S)$ et $w\in A^\ast$, l'écriture $\vect{x} +\valeur{w}\in\conf(S)$ ne permet pas de dire si la séquence $w$ est franchissable à partir de $\vect{x}$.
Il pourrait en effet exister une autre séquence $w'\in A^\ast$ franchissable à partir de $\vect{x}$ aboutissant à la configuration $\vect{x} +\valeur{w'} = \vect{x} +\valeur{w}$,
voire même un moyen d'accéder à la configuration $\vect{x} +\valeur{w} = \xinit +\valeur{u}$ depuis la configuration initiale par une autre séquence d'action $u\in A^\ast$ sans que $\xinit +\valeur{u}$ ne soit accessible depuis $\vect{x}$.

\lucas{Endroit qui coince pour Ginzburg et Yoeli :}
À l'antépénultième ligne de la preuve du théorème 1 de \cite{giyo80}, savoir $\xinit +\valeur{uw}\in\conf(S)$ pour $u\in\lang(S)$ et $w\in A^\ast$ ne permet pas d'en déduire que $uw\in\lang(S)$.

On donne ci-dessous un contre-exemple pour illustrer ce point :

\begin{Example}
Soit le $3-$VAS $S = (A:=\os{a,b,c},\xinit:=(0,0,0))$ dont les actions sont étiquetés par $\valeur{a}=(1,0,0)$, $\valeur{b}=(0,1,-1)$ et $\valeur{c}=(-1,-1,1)$.
Le langage reconnu $\lang(S)=\set{a^n}{n\in\N}$ est rationnel, et les configurations accessibles sont les $\vect{x}_n:=(n,0,0)$ pour $n\in\N$.

Cependant, pour deux entiers $m>n>0$, bien que $\lang(A,\vect{x}_m) =\lang(A,\vect{x}_n) =\lang(S)$, on a $\vect{x}_m \not\relGY \vect{x}_n$ :
Cela se constate en considérant la séquence d'actions $b^{n+1}c^{n+1}$ qui n'est jamais franchissable, mais qui vérifie $\vect{x}_m +\valeur{b^{n+1}c^{n+1}} = (m-n-1,0,0)\in \conf(S)$ alors que $\vect{x}_n +\valeur{b^{n+1}c^{n+1}} = (-1,0,0)\notin \conf(S)$.

La relation $\relGY$ admet alors une infinité de classes d'équivalences $(\os{\vect{x}_n})_{n\in\N}$.
\end{Example}

Pour corriger ce problème, on va aussi regarder si les actions sont franchissables :

\begin{Definition}
Soit $S=(A,\xinit)$ un VAS. On introduit la relation $\rel_S$ sur les configurations de $\N^d$ par
$$\forall \vect{x},\vect{y}\in\N^d, \Big(
\vect{x} \rel_S \vect{y} \ssi \lang(A,\vect{x}) = \lang(A,\vect{y}) \Big)$$
\end{Definition}

% Regarder la relation d'ordre associée $x \sqsubseteq  y$ ssi $\lang(S,x) \subseteq \lang(S,y)$

On fait ainsi immédiatement le lien avec la relation de Nérode bien connue sur les langages :

\begin{Theorem}[Nérode - \cite{rasc59} théorème 2]
    Un langage $L$ sur un alphabet fini $A$ est rationnel si et seulement si la relation $\sim_L$ sur les mots définie par
    $$\forall u,v\in A^\ast, \Big( u\sim_L v \ssi \forall w\in A^\ast, uw\in L \equivaut vw\in L \Big)$$
    qui est une relation d'équivalence invariante par composition à droite, 
    admet un nombre fini de classes d'équivalences.
\end{Theorem}

\begin{Lemma}
    Soit $S=(A,\xinit)$ un VAS et $u,v\in\lang(S)$.
    Alors $u\sim_{\lang(S)}v$ si et seulement si $\xinit +\valeur{u} \rel_S \xinit +\valeur{v}$.
\end{Lemma}

\begin{proof}
On utilise le fait que si $u\in\lang(S)$, alors
$uw\in\lang(S)$ si et seulement si $w\in\lang(A,\xinit +\valeur{u})$.

Attention, le résultat devient faux si $u,v\notin\lang(S)$, auquel cas on a toujours $u\sim_{\lang(S)}v$.
\end{proof}

\begin{Theorem}
    Pour un VAS $S$, $\lang(S)$ est rationnel si et seulement si $\rel_S$ restreint aux configurations accessibles $\conf(S)$ admet un nombre fini de classes d'équivalence.
\end{Theorem}

\begin{proof}
$\lang(S)$ est rationnel 
ssi $A^\ast/\sim_{\lang(S)}$ est fini 
ssi $\lang(S)/\sim_{\lang(S)}$ est fini 
ssi $\conf(S)/\rel_S$ est fini (en utilisant le lemme pour cette dernière équivalence).
\end{proof}

Enfin, on donne une propriété de cette relation qui sera utile pour la suite.

\begin{Proposition}
La relation d'équivalence $\rel_S$ sur les configurations d'un $d-$VAS $S$ est compatible avec les actions :
Pour tout $\vect{x},\vect{y}\in\N^d$, $\vect{x}\rel_S \vect{y}$ implique $\forall a\in A, \vect{x} +\valeur{a} \rel_S \vect{y} +\valeur{a}$.
\end{Proposition}

\lucas{Partie à supprimer :}
\color{red} % Début de la partie à supprimer

\begin{Definition}
Soit $S=(A,\xinit)$ un $d$-VAS.
On appelle \emph{congruence sur $S$} une relation d'équivalence $\rel$ sur les configurations de $\N^d$ qui est compatible avec les actions, 
c'est-à-dire telle que $\vect{x}\rel \vect{y}$ implique $\forall a\in A, \vect{x} +\valeur{a} \rel \vect{y} +\valeur{a}$.
\end{Definition}

% On donne la preuve de congruence (qui n'est pas donnée dans 2)
%Ajouter similaire à Nérode + on donne la preuve dans ce cas infini


\begin{Lemma}
 $\rel_S$ est une congruence sur le VAS $S$.
\end{Lemma}

\begin{proof}
$\rel_S$ est bien une relation d'équivalence sur $\N^d$.
De plus, $\rel_S$ est stable par les déclenchements : 
si $\vect{x}\rel_S \vect{y}$, alors pour toute action $a\in A$ et tout mot $w\in A^\ast$, 
on a $$(\vect{x} +\valeur{a}) +\valeur{w} \in\conf(S) 
    \equivaut \vect{x} +\valeur{aw} \in\conf(S)
    \equivaut \vect{y} +\valeur{aw} \in\conf(S)
    \equivaut (\vect{y} +\valeur{a}) +\valeur{w} \in\conf(S)$$
d'où $\vect{x}+\valeur{a} \rel_S \vect{y}+\valeur{a}$.
\end{proof}

\begin{Proposition}
Soit un VAS $S=(A,\xinit)$.
Alors $\rel_S$ est la plus grande congruence sur $S$ au sens de l'inclusion.
\end{Proposition}

\begin{proof}
Montrons d'abord que l'ensemble des congruences sur $S$ est dirigé :

Si $\rel_1$ et $\rel_2$ sont deux congruences sur $S$, alors notons $\rel_{1+2}$ la clôture transitive de l'union des deux relations $\rel_1\union\rel_2$.
$\rel_{1+2}$ est bien une relation d'équivalence, 
et si $\vect{x}\rel_{1+2}\vect{y}$, alors il existe une séquence finie de vecteurs ${(\vect{x}_i)}_{0\leq i\leq n}$ tels que 
$\vect{x}=\vect{x}_0$, $\vect{y}=\vect{x}_n$ et pour tout $0\leq i<n$, $\vect{x}_i\rel_1\vect{x}_{i+1}$ ou $\vect{x}_i\rel_2\vect{x}_{i+1}$.

On a alors $\vect{x}_i +\valeur{a} \rel_1 \vect{x}_{i+1} +\valeur{a}$ ou $\vect{x}_i +\valeur{a} \rel_2 \vect{x}_{i+1} +\valeur{a}$ pour tout $0\leq i<n$, 
d'où $\vect{x} +\valeur{a} \rel_{1+2} \vect{y} +\valeur{a}$, 
et $\rel_{1+2}$ est bien une congruence sur $S$ contenant $\rel_1$ et $\rel_2$.

Maintenant, si $\rel_1$ est une congruence sur $S$, pour tout $\vect{x}\rel_1\vect{y}$ et $w=a_1\dots a_n\in A$, on a 
$\vect{x} +\valeur{a_1\dots a_i} \rel_1\vect{y} +\valeur{a_1\dots a_i}$ par récurrence sur $1\leq i\leq n$, d'où $\vect{x} +\valeur{w} \rel_1\vect{y} +\valeur{w}$.
Ainsi, $\rel_1\subseteq \rel_S$, et $\rel_S$ est bien la plus grande congruence sur $S$.
\end{proof}

\color{black} % Fin de la partie à supprimer

%--------------

\subsection{Borne sur la décroissance}

Pour obtenir un nombre fini de classes d'équivalence pour $\rel_S$, on cherche une borne à partir de laquelle les configurations accessibles sont indiscernables.
Comme la seule règle sur les actions franchissables est un test de positivité, on va vouloir que les configurations ne puisse pas trop décroître.
Ginzburg et Yoeli proposent une caractérisation dans ce sens :

% Définir borné

\begin{Lemma}[\cite{giyo80} lemme 1]
    Supposons que dans un VAS $S=(A,\xinit)$, $n\leq d$ coordonnées (disons les $n$ premières) soient non-bornées.
    Supposons aussi qu'il existe $n$ entiers positifs $k_1,k_2,\dots,k_n$ tels que pour tout $\vect{x}\in\conf(S)$, tout $w\in A^\ast$ et tout $i=1,2,\dots,n$, 
   %si $(\vect{x} +\valeur{w})\in\conf(S)$ 
    si $w\in\lang(A,\vect{x})$ 
    $\vect{x}(i) - (\vect{x} +\valeur{w})(i)\geq k_i$.
    Alors $\conf(S)/\rel_S$ est fini.
\end{Lemma}

Ginzburg et Yoeli donne aussi la réciproque de ce résultat.
On va en prouver une version simplifiée, notamment en considérant le maximum $k:= \text{max}\os{k_1,\dots,k_n}$, ce qui nous donne la caractérisation suivante :

% On peut simplifier ce résultat en prenant une borne $k\in\N$ commune à toutes les coordonnées.

%begin{Theorem}
%    Soit $S=(A,\xinit)$ un VAS.
%    Alors $\lang(S)$ est rationnel si et seulement si 
%    $$\exists k\in\N, \forall \vect{x}\in\conf(S), \forall w\in A^\ast, 
%    \Big( (\vect{x} +\valeur{w})\in\conf(S) \implies \forall i\in\os{1,\dots,d}, \valeur{w}(i)\geq -k\Big)$$
%\end{Theorem}

%Une manière équivalente de formuler cette caractérisation serait

\begin{Theorem}
    Soit $S=(A,\xinit)$ un VAS.
    Alors $\lang(S)$ est rationnel si et seulement si
    \begin{equation}
        \exists k\in\N, \forall \vect{x},\vect{y}\in\N^d, 
\big( \xinit\trans{*}{S} \vect{x} \trans{*}{S} \vect{y}\implies
\vect{y}\geq \vect{x} -\vect{k} \big)
    \label{eq:caracterisation}
    \end{equation}
    %-----Une formulation en français-----:
    %il existe un $k\in\N$ tel que pour toutes configurations $\vect{x},\vect{y}\in\N^d$, si $\xinit\trans{*}{} \vect{x} \trans{*}{} \vect{y}$, alors $\vect{y}\geq \vect{x} -\vect{k}$
    où $\vect{k}$ désigne le vecteur $(k,k,...,k)\in\N^d$.
\end{Theorem}

\begin{proof}
(caractérisation $\Rightarrow$ rationnel)
Soit $S$ un VAS vérifiant la caractérisation \eqref{eq:caracterisation} pour un $k\in\N$.

Si $\vect{x},\vect{y}\in\conf(S)$ vérifient 
$\vect{x}(i)=\vect{y}(i)$ ou $\vect{x}(i)\geq k \land \vect{y}(i)\geq k$
pour toute coordonnée $i\in\os{1,\dots,d}$, alors $\vect{x}\rel_S \vect{y}$. 
En effet, on a $\vect{x} +\valeur{w} \geq\vect{0} \equivaut \vect{y} +\valeur{w} \geq\vect{0}$ pour tout $w\in A^\ast$, 
puisque les coordonnées qui diffèrent entre $\vect{x}$ et $\vect{y}$ ne peuvent devenir négatives.

Ainsi, $\rel_S$ admet au plus $(k+1)^d$ classes d'équivalences, donc $\lang(S)$ est rationnel.

\vspace{2mm}\noindent
(rationnel $\Rightarrow$ caractérisation)
Réciproquement, si $S$ ne vérifie pas la caractérisation \eqref{eq:caracterisation}, 
on a pour tout $k\in\N$ l'existence d'une configuration accessible $\vect{x}$, d'un mot $w\in \lang(A,\vect{x})$ et d'une coordonnée $j\in\os{1,\dots,d}$ tels que $(\vect{x} +\valeur{w})(j)\leq \vect{x}(j)-k$.

On note $\vect{x_p}:=\vect{x} +\valeur{a_1\cdots a_p}$ les différentes configurations obtenues en lisant $w=a_1\cdots a_n$.
On a alors $\vect{x}=\vect{x_0} \trans{a_1}{}\vect{x_1} \trans{a_2}{}\dots \trans{a_n}{}\vect{x_n}= \vect{x} +\valeur{w}$.

Notons $\xi = \text{max}\set{-\valeur{a}(j)} {a\in A} >0$ la valeur de la plus grande diminution en coordonnée $j$ possible par une action.
Alors, au moins $k/\xi$ configurations $\vect{x_p}$ voient leur coordonnée $j$ décroître,
et l'on a une sous-séquence d'extractrice $\phi$ vérifiant $\vect{x}_{\phi(0)}(j)>\vect{x}_{\phi(1)}(j)>\dots>\vect{x}_{\phi(m)}(j)$ où $m\geq k/\xi$.

% revoir ici
Ces configurations ne sont pas équivalentes pour $\rel_S$ :
En effet, si l'on avait $\vect{x}_{\phi(p)}\rel_S \vect{x}_{\phi(q)}$ avec $0\leq p\leq q\leq m$, en notant $u=a_{\phi(p)+1}\cdots a_{\phi(q)}$, 
on aurait $\vect{x}_{\phi(p)} \rel_S (\vect{x}_{\phi(p)} +\valeur{u}) =\vect{x}_{\phi(q)}$, d'où
$\vect{x}_{\phi(p)} +\valeur{u^r}\rel_S \vect{x}_{\phi(p)} +\valeur{u^{r+1}}$ pour tout $r\in\N$ (d'après la proposition).

Or $\valeur{u^r}(j) = r\times\valeur{u}(j) = r\times (\vect{x}_{\phi(q)}(j) -\vect{x}_{\phi(p)}(j)) <r$, 
ce qui prouve que $(\vect{x}_{\phi(p)} +\valeur{u^r})(j)<0$ à partir d'un certain $r\in\N$, 
et donc $\vect{x}_{\phi(p)} +\valeur{u^r} \not\rel_S \vect{x}_{\phi(p)}$, d'où une contradiction.

On conclut qu'il existe au moins $k/\xi$ classes d'équivalences pour $\rel_S$ (et ce pour tout $k\in\N$), 
ainsi $\conf(S)/\rel_S$ est infini.
\end{proof}

%\textbf{Méthode de Valk et Vidal-Naquet :}

%On prouve d'abord la réciproque en construisant un automate fini reconnaissant $\lang(S)$.
%Pour cela, on restreint simplement les états aux configurations de $\os{0,\dots,c}^d$ pour une certaine constante $c\in\N$ obtenue à partir de $k$.
%L'autre sens est montré par l'absurde, en s'appuyant sur les circuits dans le graphe de couverture de $S$.

\section{Décider la caractérisation}

La procédure de décision nécessite de connaître deux choses :
\begin{enumerate}
    \item D'abord, la liste des éléments maximaux de l'arbre de  associé au VAS,
    \item Ensuite, une procédure pour décider si les configurations accessibles d'un VAS sont bornés.
\end{enumerate}

\begin{Definition}
Soit $S=(A,\xinit)$ un $d$-VAS.
Pour tout élément maximal $\vect{m}\in\Nomega$ de l'arbre de couverture, notons $I_\vect{m}:=\set{j}{\vect{m}(j)\neq \omega}$ l'ensemble des coordonnées bornées pour les configurations accessibles en partant en dessous de $\vect{m}$.
On écrit $I_\vect{m}=\os{j_1,\dots,j_p}$.
Pour tout $i\notin I_\vect{m}$, on définit un $(p+1)$-VAS $S_{(\vect{m},i)} =(A_{(\vect{m},i)}, \vect{x}_{(\vect{m},i)})$ en posant
$A_{(\vect{m},i)} :=\set{a(\vect{m},i)}{a\in A}$ avec $\valeur{a(\vect{m},i)} :=(a(j_1),\dots,a(j_p),-a(i))$, 
et $\vect{x}_{(\vect{m},i)} :=(\vect{m}(j_1),\dots,\vect{m}(j_p),0)$.
\end{Definition}

On regarde ainsi le comportement de chaque coordonnée non-bornée indépendamment des autres.
Le théorème suivant est alors obtenu :

\begin{Theorem}
    Soit $S=(A,\xinit)$ un $d$-VAS.
    Alors $S$ satisfait la caractérisation \eqref{eq:caracterisation} si et seulement si tous les VAS $S_{(\vect{m},i)}$ définis ci-dessus sont bornés pour tout élément maximal $\vect{m}$ et tout $i\notin I_\vect{m}$.
\end{Theorem}

%----------------------------------------------------------------

\section{Bornes}

Détaillons maintenant plusieurs propriétés de bornes sur les coordonnées des vecteurs configurations.
On regarde $\os{1,\dots,d}$ l'ensemble des indices des vecteurs codant les configurations d'un VAS $S=(A,\xinit)$.
On peut voir ces coordonnées comme des emplacements accueillant un certain nombre de jetons, qui sont ajoutés ou retirés lors du déclenchement d'une action (lien avec les réseaux de Petri).

Soit $I\subseteq \os{1,\dots,d}$ un sous-ensemble d'indices.
On dira que
\begin{itemize}
    \item $I$ est \emph{borné} pour $\vect{x}\in \Nomega^d$ lorsqu'il existe toujours une coordonnée d'indice dans $I$ qui soit bornée pour toute configuration accessible depuis $\vect{x}$ :
    $$\exists k\in\N, \forall \vect{y}\in\conf(S,\vect{x}), \exists i\in I, \vect{y}(i)\leq k$$
    
    \item $I$ est \emph{uniformément borné} pour $\vect{x}\in \Nomega^d$ lorsque toutes les coordonnées d'indice dans $I$ sont bornées pour toute configuration accessible depuis $\vect{x}$ :
    $$\exists k\in\N, \forall \vect{y}\in\conf(S,\vect{x}), \forall i\in I, \vect{y}(i)\leq k$$
    
    \item $I$ est \emph{borné inférieurement} pour $\vect{x}\in \Nomega^d$ lorsqu'au moins une coordonnée dans $I$ ne diminue pas plus qu'une certaine borne (même en augmentant les ressources initiales) :
    $$\exists k\in\N, \forall n\in\N, \forall \vect{y}\in\conf(S,\vect{x} + n\cdot\indicatrice{I}), \exists i\in I, \vect{y}(i)\geq \vect{x}(i)+n-k$$
    
    \item $I$ est \emph{uniformément borné inférieurement} pour $\vect{u}\in \Nomega^d$ lorsque toutes les coordonnées de $I$ ne décroissent pas plus d'une certaine valeur :
    $$\exists k\in\N, \forall n\in\N, \forall \vect{y}\in\conf(S,\vect{x} + n\cdot\indicatrice{I}), \forall i\in I, \vect{y}(i)\geq \vect{x}(i)+n-k$$
\end{itemize}

\section{Commentaires}
biblio à commencer\\
vérifier qu'on peut énoncer Vidal-Naquet sur le graphe de couverture minimal défini par le graphe de Karp-Miller dans lequel on a gardé que les marquages maximaux.\\
vérifier que ce nouveau graphe peut être obtenu à partir de Clover en ajoutant les transitions possibles (prolongées par continuité sur $\N^d$). Vérifier qu'il ne manque pas de transitions utiles.

%================================================================

\begin{thebibliography}{10}

\bibitem{rasc59}
M. O. Rabin and D. Scott.
\newblock Finite Automata and Their Decision Problems.
\newblock {\em IBM Journal of Research and Development}, vol. 3, pages 114-125, 1959.

\bibitem{giyo80}
A. Ginzburg and M. Yoeli.
\newblock Vector Addition Systems and Regular Languages.
\newblock {\em Journal of Computer and System Science} 20, pages 277-284, 1980.

\bibitem{vavi81}
R. Valk and G. Vidal-Naquet.
\newblock Petri Nets and Regular Languages.
\newblock {\em Journal of Computer and System Science} 23, pages 299-325, 1981.

\end{thebibliography}

\end{document}