\documentclass[a4paper,final]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}

\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{xspace}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{dsfont}
\usepackage{array}
\usepackage[french]{algorithm2e}
\usepackage{stmaryrd}
\usepackage[normalem]{ulem}

\usepackage{geometry}
\geometry{hmargin=3cm,vmargin=2cm}

\theoremstyle{definition}
\newtheorem{Theorem}{Théorème}
\newtheorem{Definition}[Theorem]{Définition}
\newtheorem{Proposition}[Theorem]{Proposition}
\newtheorem{Lemma}[Theorem]{Lemme}
\newtheorem{Property}[Theorem]{Propriété}
\newtheorem{Example}[Theorem]{Exemple}
\newtheorem*{Remark}{Remarque}
\newtheorem*{Statement}{Énoncé}
%\newtheorem{Proof}{Preuve}

\let\oldphi\phi
\let\phi\varphi
\let\oldepsilon\epsilon
\let\epsilon\varepsilon
\let\leq\leqslant
\let\geq\geqslant

%================================================================

\newcommand{\alain}[1]{\textcolor{blue}{#1}}
\newcommand{\lucas}[1]{\textcolor{olive}{#1}}
\newcommand{\rayer}[1]{\textcolor{red}{#1}}
% \sout pour rayer

\newcommand{\set}[2]{\left\{#1\mathrel{\left|\vphantom{#1}\vphantom{#2}\right.}#2\right\}}
\newcommand{\os}[1]{\left\{\mathinner{#1}\right\}}
\newcommand{\defeq}{\ensuremath{\stackrel{\textit{def}}{=}}}
\let\union\cup
\let\inter\cap
\newcommand{\abs}[1]{\ensuremath{\displaystyle\left\lvert #1 \right\rvert}}

\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Z}{\ensuremath{\mathbb{Z}}}
\newcommand{\Nomega}{\ensuremath{\mathbb{N}_\omega}}
\newcommand{\indicatrice}[1]{\ensuremath{\mathds{1}_{#1}}}
\newcommand{\card}[1]{|#1|}

\newcommand{\petri}{réseau de Petri\xspace}
\newcommand{\fire}[2]{\ensuremath{#1 (#2\rangle}}
\newcommand{\lang}{\ensuremath{\mathcal{L}}}
\newcommand{\reach}{\ensuremath{\mathcal{R}}}
\newcommand{\cover}{\ensuremath{\mathcal{C}}}
\newcommand{\clover}{\textit{Clover}}
\newcommand{\trans}[2]{\ensuremath{\stackrel{#1}{\longrightarrow}_{#2}}}
\newcommand{\transZ}[1]{\ensuremath{\stackrel{#1}{\rightsquigarrow}}}

\newcommand{\vect}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\action}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\rel}{\ensuremath{\equiv}}
\newcommand{\relGY}{\ensuremath{\equiv^\text{GY}_S}}
\newcommand{\ssi}{\ensuremath{\text{ ssi }}}
\newcommand{\equivaut}{\ensuremath{\Leftrightarrow}}
\newcommand{\xinit}{\ensuremath{\vect{x}_\text{init}}}
\newcommand{\valeur}[1]{\ensuremath{\overline{#1}}}

%================================================================

\title{Décidabilité de la rationalité pour les WSTS}
\author{Lucas \textsc{Bueri}}
\date{Stage M2 - 2021}

\begin{document}

\maketitle

%================================================================

\section{Réseaux de Petri}

Un \petri $N = (P,T,B,F,M_0)$ est la donnée de
\begin{itemize}
    \item un ensemble fini $P$ de $d$ emplacements,
    \item un ensemble fini $T$ de transitions,
    \item une fonction de coût $B: P\times T\to\N$,
    \item une fonction de production $F: P\times T\to\N$,
    \item un marquage initial $M_0: P\to\N$.
\end{itemize}

Les configurations sont les marquages $M: P\to\N$, aussi considérés comme les valeurs possibles de $d$ compteurs (vecteur de $\N^d$).
On peut déclencher la transition $t$ à partir du marquage $M$ si et
seulement si $M(p)\geq B(p,t)$ pour tout $p\in P$ (noté $M\geq B(\cdot,t)$).

On obtient alors un nouveau marquage $M'$ défini par $M' \defeq M+D(\cdot,t)$ où $D\defeq F-B$. 
$B$ représente donc le coût de la transition (le nombre de jetons requis et consommés dans chaque emplacement), et $F$ représente sa production (les jetons créés lors du déclenchement).

On notera $\fire{M}{t}$ lorsque $t$ peut se déclencher sur $M$, et $\fire{M}{t}M'$ si déclencher $t$ sur $M$ donne $M'$.
On étendra naturellement cette notation (ainsi que $B(p,\cdot)$ et $F(p,\cdot)$) aux séquences de transitions, ou mots $w\in T^\ast$.

Deux ensembles nous intéresseront alors : le langage $\lang(N)\defeq \set{w\in T^\ast} {\fire{M_0}{w}}$ du \petri et les configurations accessibles $\reach(N)\defeq \set{M':P\to\N}{\exists w\in T^\ast, \fire{M_0}{w}M'}$.

%----------------------------------------------------------------

\section{VAS}

\subsection{La structure}

Un \emph{système d'addition de vecteurs de dimension} $d\in\N$ ($d-$VAS) $S=(A,\xinit)$ est la donnée d'un vecteur initial $\xinit\in\N^d$ et d'un ensemble fini $A$ d'\emph{actions}.
À chaque action $a\in A$ est associé un unique vecteur $\valeur{a}\in \Z^d$, de telle manière à ce que deux actions ne soient pas associées au même vecteur de $\Z^d$.
\vspace{3mm}
% On pourra préciser ce qu'il se passe si deux actions sont étiquetés par le même vecteur.

Les \emph{configurations} de $S$ sont alors les vecteurs de $\N^d$ (à coordonnées positives), 
et chaque action $a\in A$ agit sur $\N^d$ en additionnant à la configuration courante le vecteur $\valeur{a}$ associé.
On a alors une transition entre $\vect{x}$ et $\vect{y}$ étiquetée par l'action $a$ lorsque $\vect{x} + \valeur{a} = \vect{y}$.

De manière équivalente, on dira que l'action $a\in A$ est \emph{franchissable} 
à partir de la configuration $\vect{x}\in \N^d$ lorsque $\vect{x} + \valeur{a} \geq \vect{0}$,
et son déclenchement aboutit à la configuration $\vect{y} = \vect{x} + \valeur{a}$ à travers la transition $(\vect{x},a,\vect{y})\in \N^d\times A\times \N^d$.
On notera $\vect{x}\trans{a}{S} \vect{y}$ lorsqu'un tel déclenchement est possible (ou simplement $\vect{x}\trans{a}{} \vect{y}$ s'il n'y a pas ambiguïté sur $S$).

\begin{center}
Par la suite, on notera $I \defeq \os{1,\dots,d}$ l'ensemble des coordonnées pour les configurations.
\end{center}

%On munit $\N^d$ (et $\Z^d$) de l'addition terme à terme, et de l'ordre usuel $\vect{x}\leq\vect{y}$ ssi $\forall i\in I, \vect{x}(i) \leq \vect{y}(i)$.

Lorsqu'une séquence d'actions $w= a_1\cdots a_k\in A^\ast$ permet d'aller de $\vect{x}$ à $\vect{y}$ par la séquence de transition $\vect{x}= \vect{x_0}\trans{a_1}{} \vect{x_1}\trans{a_2}{} \dots\trans{a_k}{} \vect{x_k}=\vect{y}$
(où $\vect{x_0},\dots,\vect{x_k} \in\N^d$ et $\vect{x_{i-1}} +\valeur{a_i} =\vect{x_i}$ pour tout $1\leq i\leq k$),
on dit que $w$ est franchissable à partir de $\vect{x}$, et qu'on a une \emph{exécution} $\rho :\vect{x}\trans{w}{S} \vect{y}$.\\
$\vect{y}$ est alors dit accessible à partir de $\vect{x}$.

De plus, en notant $\valeur{w}\defeq \sum^k_{i=1} \valeur{a_i}$ le vecteur associé à $w$, on obtient $\vect{x} +\valeur{w} = \vect{y}$.
Attention, cette égalité peut-être vérifiée même si $w$ n'est pas franchissable.
\vspace{3mm}

Nous allons étudier deux ensembles naturellement associés à un VAS $S=(A,\xinit)$ :
\begin{enumerate}
    \item 
    $\lang(A,\vect{x})\defeq \set{w\in A^\ast} {\exists \vect{y}\in\N^d, \vect{x}\trans{w}{S}\vect{y}}$ qui est le \emph{langage} des séquences d'actions franchissables à partir de la configuration $\vect{x}$,
    
    \item $\reach(A,\vect{x})\defeq \set{\vect{y}\in\N^d} {\exists w\in A^\ast, \vect{x}\trans{w}{S} \vect{y}}$ qui est l'ensemble des configurations \emph{accessibles} à partir de $\vect{x}$. 
\end{enumerate}

En particulier, on regardera $\lang(S) \defeq \lang(A,\xinit)$ le langage du VAS $S$, et $\reach(S) \defeq \reach(A,\xinit)$ l'ensemble d'accessibilité de $S$.

% A déplacer ?
\begin{Definition}
Un VAS $S$ est \emph{rationnel} si $\lang(S)$ est rationnel sur $A^\ast$.
\end{Definition}

\begin{Definition}
Soit $S = (A,\xinit)$ un $d-$VAS et $J\subseteq I$ un sous-ensemble d'indices.
\begin{itemize}
    \item $S$ est \emph{borné} sur $J$ lorsque toute configuration accessible a ses coordonnées de $J$ bornées :
    $$\exists k\in\N, \forall \vect{y}\in\reach(S), \forall j\in J, \vect{y}(j)\leq k$$
    
    \item $S$ est \emph{borné inférieurement} sur $J$ lorsque toutes les coordonnées de $J$ ne diminue pas plus qu'une certaine borne (même en augmentant les ressources initiales) :
    $$\exists k\in\N, \forall n\in\N, \forall \vect{y}\in\reach(A,\xinit + n\cdot\indicatrice{J}), \forall j\in J, \vect{y}(j)\geq \vect{x}(j)+n-k$$
\end{itemize}
\end{Definition}
%----------------------------------------------------------------

\subsection{Clover et le graphe de couverture}

On aimerait avoir un meilleur aperçu des configurations accessibles, et notamment décrire de manière finie les capacités pour le VAS d'atteindre des configurations non-bornées.
Rappelons d'abord la notion d'idéal :

\begin{Definition}
Soit $(X,\leq)$ un ensemble ordonné et $E\subseteq X$ un sous-ensemble de $E$.
\begin{itemize}
    \item $E$ est dit \emph{dirigé} lorsque pour tous $x,y\in E$ il existe un $z\in E$ vérifiant $x\leq z$ et $u\leq z$.
    \item $E$ est dit \emph{clos par le bas} lorsqu'il est égal à sa clôture par le bas $\downarrow E \defeq \set{x\in X}{\exists y\in E, x\leq y}$.
    \item Enfin, $E$ est un \emph{idéal} s'il est dirigé et clos par le bas.
\end{itemize}
\end{Definition}

On peut maintenant introduire l'ensemble de couverture $\cover(A,x) \defeq \downarrow \reach(A,x)$ d'un VAS.
Il est clos par le bas dans $(\N^d,\leq)$ bien ordonné, donc se décomposition comme une union finie d'idéaux.

Les idéaux de $\N^d$ peuvent se voir comme des éléments de $\Nomega^d$, obtenu en étendant $\N$ en $\Nomega\defeq \N\union\os{\omega}$ de façon naturelle. % À préciser ?

\begin{Definition}
Soit $S=(A,\xinit)$ un $d-$VAS.
On définit $\clover(S) \subseteq \Nomega^d$ comme l'ensemble des idéaux maximaux inclus dans $\cover(S)$.
C'est aussi l'unique ensemble de taille minimale d'idéaux dont l'union correspond à $\cover(S)$.
\end{Definition}

%-----------

%Cela va nous permettre de représenter le graphe des configurations accessibles de manière finie (bien qu'il puisse exister une infinité de configurations accessibles).
\lucas{À revoir.}

Le \emph{graphe de couverture} a pour sommets des configurations de $\Nomega^d$ et pour arêtes des transitions du VAS, étiquetés par une action de $A$.
Il est obtenu en partant d'un sommet initial $s_0:\xinit$ étiqueté par la configuration initiale $\xinit\in \N^d$, puis par récurrence sur la profondeur des noeuds en indiquant les voisins des noeuds accessibles :

Pour chaque noeud $s:\vect{x}$ associé à la configuration $\vect{x}\in \Nomega^d$, on fait partir de $s$ autant d'arêtes que d'actions $a\in A$ qui sont franchissables à partir de $\vect{x}$.
Le sommet d'arrivée de l'arête associée à une action $a$ est déterminé ainsi :
\begin{itemize}
    \item Si $\vect{x}\trans{a}{} \vect{y}$ (déclencher $a$ aboutit à la configuration $\vect{y} = \vect{x} + \valeur{a}$) 
    et qu'il existe un sommet déjà existant $r:\vect{y}$ associé à cette configuration, alors on crée une arête étiquetée par $a$ de $s:\vect{x}$ vers $r:\vect{y}$ ;
    \item Si $\vect{x}\trans{a}{} \vect{y}$ et qu'il existe un ancêtre $r:\vect{z}$ de $s$ (c'est-à-dire tel qu'il existe une chemin dans le graphe déjà créé de $r$ à $s$) avec $\vect{y}>\vect{z}$, 
    alors on crée un nouveau sommet $s':\vect{y'}$ et une arête de $s:\vect{y}$ vers $s':\vect{y'}$ étiquetée par $a$, 
    où $\vect{y'}\in \Nomega^d$ est la configuration de coordonnées $\vect{y'}(i) = \vect{y}(i)$ pour les $1\leq i\leq d$ tels que $\vect{y}(i)=\vect{z}(i)$, et $\vect{y'}(i) = \omega$ si $\vect{y}(i)>\vect{z}(i)$ ;
    \item Si la configuration $\vect{y}$ atteinte n'est pas dans les cas précédents, on crée simplement un nouveau sommet $s':\vect{y}$ et une arête de $s$ à $s'$ étiquetée par $a$.
\end{itemize}

%----------------------------------------------------------------

\section{Une caractérisation pour la rationalité}

La preuve de décidabilité se divise en deux étapes.
Tout d'abord, on va donner une caractérisation mathématique équivalente à la rationalité.
On montrera ainsi qu'un VAS est rationnel si et seulement s'il existe une borne $k\in\N$ telle que si on peut accéder à la configuration $\vect{x}$, puis à $\vect{y}$, alors $\vect{y}$ reste au dessus de $\vect{x}-\vect{k}$
%ssi il existe une borne sur la décroissance possible des coordonnées des configurations.
($\vect{k}$ désignera le vecteur $(k,k,...,k)\in\N^d$).

\subsection{La relation d'équivalence de Ginzburg et Yoeli n'est pas d'index fini}

Ginzburg et Yoeli introduisent dans \cite{giyo80} une relation d'équivalence $\relGY$ sur les configurations et énoncent que $\lang(S)$ est rationnel si et seulement si $\relGY$ admet un nombre fini de classes d'équivalence dans $\reach(S)$ (\cite{giyo80}, Théorème 1).

S'il est vrai que $\reach(S)/\relGY$ fini implique que $\lang(S)$ est rationnel, la réciproque est fausse et nous donnerons un contre-exemple d'un langage $\lang(S)$ rationnel tel que $\reach(S)/\relGY$ est infini. 
Nous proposerons de reprendre l'idée de Ginzburg et Yoeli,
mais en définissant une autre relation d'équivalence pour laquelle on obtiendra cette fois-ci l'équivalence entre la rationalité du langage et le quotient fini selon cette relation.

\begin{Definition}[\cite{giyo80} section 3]
Soit $S=(A,\xinit)$ un VAS. La relation $\relGY$ est définie pour tout $\vect{x},\vect{y} \in\reach(S)$ par : 
$$\vect{x}\relGY\vect{y} \ssi \forall w\in A^\ast, \big( \vect{x} +\valeur{w}\in\reach(S) \equivaut \vect{y} +\valeur{w}\in\reach(S) \big)$$
\end{Definition}
\alain{ça donne quoi si on définit $\relGY$ sur tout $\N^d$ ? Une classe de plus seulement ? Une infinité ?}

\begin{Remark}
$\relGY$ est une relation d'équivalence sur l'ensemble $\reach(S)$ des configurations accessibles.
\end{Remark}

On aurait envie d'obtenir un résultat similaire à celui de Nérode, à savoir dire que $\lang(S)$ est rationnel si et seulement si $\relGY$ admet un nombre fini de classes d'équivalence.
Cela est malheureusement faux, puisque pour $\vect{x}\in\reach(S)$ et $w\in A^\ast$, l'écriture $\vect{x} +\valeur{w}\in\reach(S)$ ne permet pas de dire si la séquence $w$ est franchissable à partir de $\vect{x}$.
Il pourrait en effet exister une autre séquence $w'\in A^\ast$ franchissable à partir de $\vect{x}$ aboutissant à la configuration $\vect{x} +\valeur{w'} = \vect{x} +\valeur{w}$,
voire même un moyen d'accéder à la configuration $\vect{x} +\valeur{w} = \xinit +\valeur{u}$ depuis la configuration initiale par une autre séquence d'action $u\in A^\ast$ sans que $\xinit +\valeur{u}$ ne soit accessible depuis $\vect{x}$.

Plus précisément sur la preuve de Ginzburg et Yoeli, 
avoir $\reach(S)/\relGY$ fini implique bien $\lang(S)$ rationnel, ce qui est prouvé en construisant explicitement l'automate.
Par contre, la réciproque est fausse : 
L'erreur (avant-dernière ligne de la preuve du théorème 1 de \cite{giyo80}) était d'affirmer que savoir $\xinit +\valeur{uw}\in\reach(S)$ pour $u\in\lang(S)$ et $w\in A^\ast$ permettait d'en déduire que $uw\in\lang(S)$.

\vspace{5mm}

On donne ci-dessous un contre-exemple pour illustrer ce point.
Il est nécessaire de se placer au moins en dimension 3, car le résultat de Ginzburg et Yoeli reste vrai en dimension inférieure.

\lucas{Ajouter preuve que le résultat reste vrai en dimension inférieure à 2.}

\begin{Example}
Soit le $3-$VAS $S = (A=\os{a,b,c}, \xinit=(0,0,0))$ dont les actions sont étiquetés par $\valeur{a}=(1,0,0)$, $\valeur{b}=(0,1,-1)$ et $\valeur{c}=(-1,-1,1)$.
Le langage reconnu $\lang(S)=a^\ast$ est rationnel, et les configurations accessibles sont les $\vect{x}_n=(n,0,0)$ pour $n\in\N$.

Cependant, pour deux entiers $m>n>0$, bien que $\lang(A,\vect{x}_m) =\lang(A,\vect{x}_n) =\lang(S)$, on a $\vect{x}_m \not\relGY \vect{x}_n$ :
Cela se constate en considérant la séquence d'actions $b^{n+1}c^{n+1}$ qui n'est jamais franchissable, mais qui vérifie $\vect{x}_m +\valeur{b^{n+1}c^{n+1}} = (m-n-1,0,0)\in \reach(S)$ alors que $\vect{x}_n +\valeur{b^{n+1}c^{n+1}} = (-1,0,0)\notin \reach(S)$.

La relation $\relGY$ admet alors une infinité de classes d'équivalences $(\os{\vect{x}_n})_{n\in\N}$ sur $S$.
\end{Example}


\subsection{Une autre relation d'équivalence qui est d'index fini}
Pour corriger ce problème, on va aussi regarder si les actions sont franchissables :

\begin{Definition}
Soit $S=(A,\xinit)$ un VAS. On introduit la relation $\rel_S$ sur les configurations en posant pour tout $\vect{x},\vect{y} \in\N^d$ :
$$\vect{x} \rel_S \vect{y} \ssi \lang(A,\vect{x}) = \lang(A,\vect{y})$$
\end{Definition}

% Regarder la relation d'ordre associée $x \sqsubseteq  y$ ssi $\lang(S,x) \subseteq \lang(S,y)$

Constatons déjà que cette nouvelle relation est plus grande que celle de Ginzburg et Yoeli (au sens de l'inclusion) :

\begin{Proposition}
Soit $S=(A,\xinit)$ un VAS et $\vect{x},y \in\lang(S)$.
Si $\vect{x} \relGY y$ alors $\vect{x} \rel_S y$.
\end{Proposition}

\begin{proof}
Supposons $\vect{x} \relGY \vect{y}$ et montrons $\lang(A,\vect{x}) \subseteq \lang(A,\vect{y})$ par récurrence sur la longueur des mots.
Soit $w\in\lang(A,\vect{x})$.

Si $w=\epsilon$ est le mot vide, $\vect{y} \in\lang(S)$ assure que $\epsilon\in\lang(S,\vect{y})$.

Sinon, on écrit $w=ua$ avec $u\in A^\ast$ et $a\in A$.
$u\in\lang(A,\vect{x})$ est plus court que $w$, donc par hypothèse de récurrence on a également $u\in\lang(A,\vect{y})$.
$u$ est donc franchissable depuis $\vect{y}$.
Mais $ua\in\lang(A,\vect{x})$, ce qui assure que $\vect{x} +\valeur{ua}\in\reach(S)$.

Comme $\vect{x} \relGY \vect{y}$, on obtient que $\vect{y} +\valeur{ua} \in\reach(S)$, aboutissant à $\vect{y} +\valeur{ua} \geq\vect{0}$.
L'action $a$ est donc franchissable depuis $\vect{y} +\valeur{u}$.
En résumé, on a les transitions valides $\vect{x} \trans{u}{S} \vect{x} +\valeur{u} \trans{a}{S} \vect{x} +\valeur{w}$, d'où $w\in\lang(A,y)$.

On conclut enfin que $\lang(A,\vect{x}) = \lang(A,\vect{y})$ par symétrie.
\end{proof}

On va établir le lien avec la relation de Nérode $\sim_L$ associée à un langage $L \subseteq A^*$. 
Pour tout $u,v\in A^\ast$, on définit: 
$$ u\sim_L v \ssi \forall w\in A^\ast, uw\in L \equivaut vw\in L $$

%$$\forall u,v\in A^\ast, \Big( u\sim_L v \ssi \forall w\in A^\ast, uw\in L \equivaut vw\in L \Big)$$

On sait que $\sim_L$ est une relation d'équivalence invariante par composition à droite et qu'un langage $L \subseteq A^*$ est rationnel si et seulement si $A^*/\sim_L$ est fini (\cite{rasc59}, Théorème 2).

%	admet un nombre fini de classes d'équivalences.

La congruence de Nérode concerne donc les mots plutôt que les configurations, mais est liée à l'équivalence $ \rel_S$ sur les VAS de la manière suivante :

\begin{Lemma}\label{lien avec Nérode}
    Soient $S=(A,\xinit)$ un VAS et $u,v\in\lang(S)$.
    On a $u\sim_{\lang(S)}v$ si et seulement si $\xinit +\valeur{u} \rel_S \xinit +\valeur{v}$.
\end{Lemma}

\begin{proof}
%L'implication $u\sim_{\lang(S)}v \implies \xinit +\valeur{u} \rel_S \xinit +\valeur{v}$ est vrai pour tout $u,v \in A^*$.
Si $u\in\lang(S)$, alors pour tout mot $w\in A^\ast$, on a l'équivalence :
$$uw\in\lang(S) \equivaut w\in\lang(A,\xinit +\valeur{u})$$

On en déduit immédiatement le résultat en reprenant les définitions de chaque relation.
\end{proof}

%\alain{à relire et corriger}
%Remarque:  L'implication réciproque \alain{préciser quel sens:  $\xinit +\valeur{u} \rel_S \xinit +\valeur{v}$
%n'implique pas $u\sim_{\lang(S)}v$} si $u,v\notin\lang(S)$ \alain{est-ce suffisant qu'un des deux mots ne soit pas dans L(S) ? }, 
%auquel cas on a toujours $u\sim_{\lang(S)}v$.

\begin{Remark}
La relation de Nérode ne s'intéresse qu'aux mots du langage, et $\set{w\in A^\ast}{w\notin\lang(S)}$ forme une unique classe d'équivalence pour $\sim_{\lang(S)}$.
Ainsi, le lemme \ref{lien avec Nérode} devient faux dès lors que $u,v\notin\lang(S)$, puisque l'on a toujours $u\sim_{\lang(S)}v$ dans ce cas sans que $\xinit +\valeur{u} \rel_S \xinit +\valeur{v}$ ne soit nécessairement vrai.
\end{Remark}


\begin{Theorem}\label{lien relation-rationnel}
    Pour un VAS $S$, $\lang(S)$ est rationnel si et seulement si $\reach(S)/\rel_S$ est fini.
%	restreint aux configurations accessibles $\reach(S)$ admet un nombre fini de classes d'équivalence.
\end{Theorem}

\begin{proof}
On a les équivalences suivantes: \\
$\lang(S)$ est rationnel 
ssi $A^\ast/\sim_{\lang(S)}$ est fini (propriété de la relation de Nérode) \\
ssi $\lang(S)/\sim_{\lang(S)}$ est fini (car $\sim_{\lang(S)}$ admet un seule classe d'équivalence sur $A^\ast \setminus \lang(S)$) \\
ssi $\reach(S)/\rel_S$ est fini (par le lemme \ref{lien avec Nérode}).
\end{proof}

Enfin, on donne une propriété de monotonie pour cette relation, qui appuie son intérêt pour l'étude du système de transition $S$.

\begin{Proposition}\label{Monotonie relation}
La relation d'équivalence $\rel_S$ sur les configurations d'un $d-$VAS $S$ est compatible/monotone avec les actions :
Pour tout $\vect{x},\vect{y} \in\N^d$, $\vect{x}\rel_S \vect{y}$ implique $\forall a\in A, \vect{x} +\valeur{a} \rel_S \vect{y} +\valeur{a}$.
\end{Proposition}

\begin{Remark}
La relation $\relGY$ de Ginzburg et Yoeli vérifie également cette propriété.
\end{Remark}

%--------------

\subsection{Borne sur la décroissance}

Pour obtenir un nombre fini de classes d'équivalence pour $\rel_S$, on cherche une borne à partir de laquelle les configurations accessibles sont indiscernables.
Comme la seule règle restreignant les actions franchissables est un test de positivité, on va exiger que les configurations ne puissent pas trop décroître.

Ginzburg et Yoeli proposent une caractérisation au travers des deux lemmes suivants :

% Définir borné ?

\begin{Statement}[\cite{giyo80} Lemme 1]
    Supposons que dans un VAS $S=(A,\xinit)$, $n\leq d$ coordonnées (disons les $n$ premières) soient non-bornées.
    Supposons aussi qu'il existe $n$ entiers positifs $k_1,k_2,\dots,k_n$ tels que pour tout $\vect{x}\in\reach(S)$, tout $w\in A^\ast$ et tout $i=1,2,\dots,n$, 
    $(\vect{x} +\valeur{w})\in\reach(S)$ implique
    %si $w\in\lang(A,\vect{x})$ 
    $\vect{x}(i) - (\vect{x} +\valeur{w})(i) \leq k_i$.
    Alors $\reach(S)/\relGY$ est fini.
\end{Statement}

Ce résultat est correct, et nous l'adapterons facilement à la relation $\rel_S$ en modifiant la propriété requise en conséquence.
Notons qu'il n'est pas nécessaire de prendre des valeurs différentes pour les $k_i$, il est tout à fait possible de considérer leur maximum.

\begin{Statement}[\cite{giyo80} Lemme 2]
    Soit $S=(A,\xinit)$ un VAS, et supposons qu'il existe une coordonnée non-bornée $j$ telle que 
    pour tout $k\geq 0$, il existe une configuration $\vect{x}\in\reach(S)$ et un mot $w\in A^\ast$ tels que 
    $(\vect{x} +\valeur{w}) \in\reach(S)$ et $\vect{x}(j) - (\vect{x} +\valeur{w})(j) > k$.
    Alors l'ensemble $\reach(S)/\relGY$ est infini.
\end{Statement}

Cette fois, la preuve donnée comporte une erreur de même nature que précédemment :
Il est affirmé que si $\vect{x} +\valeur{w} \in\reach(S)$, alors toutes les étapes intermédiaires sont accessibles, ce qui n'est pas forcément vrai.
Le résultat semble cependant vrai \lucas{(à vérifier)}, mais n'apporte pas la caractérisation souhaitée.

\vspace{5mm}

Donnons maintenant une caractérisation similaire pour la relation $\rel_S$.
La preuve suit les idées de Ginzburg et Yoeli \cite{giyo80} en effectuant les modifications nécessaires.

\begin{Theorem}\label{caractérisation}
    Soit $S=(A,\xinit)$ un VAS.
    Alors $\lang(S)$ est rationnel si et seulement si
    \begin{equation}
        \exists k\in\N, \forall \vect{x},\vect{y}\in\N^d, 
\big( \xinit\trans{*}{S} \vect{x} \trans{*}{S} \vect{y}\implies
\vect{y}\geq \vect{x} -\vect{k} \big)
    \label{eq:caracterisation}
    \end{equation}
    %-----Une formulation en français-----:
    %il existe un $k\in\N$ tel que pour toutes configurations $\vect{x},\vect{y}\in\N^d$, si $\xinit\trans{*}{} \vect{x} \trans{*}{} \vect{y}$, alors $\vect{y}\geq \vect{x} -\vect{k}$
\end{Theorem}

\begin{proof}
Commençons par montrer le sens $\big($ \eqref{eq:caracterisation} $\Rightarrow \lang(S)$ rationnel $\big)$.
Soit $S$ un VAS vérifiant la propriété \eqref{eq:caracterisation} pour un $k\in\N$.

Soit $\vect{x},\vect{y}\in\reach(S)$.
Supposons que $\vect{x}$ et $\vect{y}$ sont indiscernables pour les petites valeurs, c'est-à-dire que pour toute coordonnée $i\in I$, on a 
soit $\vect{x}(i)=\vect{y}(i)$, 
soit $\big( \vect{x}(i)\geq k \text{ et } \vect{y}(i)\geq k \big)$.
Alors $\vect{x}\rel_S \vect{y}$. 
En effet, on a $\vect{x} +\valeur{w} \geq\vect{0} \equivaut \vect{y} +\valeur{w} \geq\vect{0}$ pour tout $w\in A^\ast$, 
puisque les coordonnées qui diffèrent entre $\vect{x}$ et $\vect{y}$ ne peuvent devenir négatives.

Ainsi, $\rel_S$ admet au plus $(k+1)^d$ classes d'équivalences, donc $\lang(S)$ est rationnel (théorème \ref{lien relation-rationnel}).

\vspace{4mm}\noindent
Prouvons maintenant la réciproque $\big(\lang(S)$ rationnel $\Rightarrow$ \eqref{eq:caracterisation} $\big)$ par contraposée.
Si $S$ ne vérifie pas la propriété \eqref{eq:caracterisation}, alors
pour tout $k\in\N$, il existe une configuration accessible $\vect{x}$, un mot $w\in \lang(A,\vect{x})$ et une coordonnée $i\in I$ tels que $(\vect{x} +\valeur{w})(i)\leq \vect{x}(i)-k$.

On note $\vect{x_p} = \vect{x} +\valeur{a_1\cdots a_p} \in\reach(S)$ les différentes configurations obtenues en lisant $w=a_1\cdots a_n$.
On a alors $\vect{x}=\vect{x}_0 \trans{a_1}{}\vect{x}_1 \trans{a_2}{}\dots \trans{a_n}{}\vect{x}_n= \vect{x} +\valeur{w}$.

Notons $\xi = \text{max}\set{\abs{\valeur{a}(j)}} {a\in A, j\in I}$ la valeur de la plus grande variation d'une coordonnée possible par une action.
Alors, au moins $k/\xi$ configurations $\vect{x}_p$ voient leur coordonnée $i$ décroître,
et l'on a une sous-séquence d'extractrice $\phi$ vérifiant $\vect{x}_{\phi(0)}(i)>\vect{x}_{\phi(1)}(i)>\dots>\vect{x}_{\phi(h)}(i)$ où $h\geq k/\xi$.


Ces configurations ne sont pas équivalentes pour $\rel_S$ :
En effet, si l'on avait $\vect{x}_{\phi(p)}\rel_S \vect{x}_{\phi(q)} = (\vect{x}_{\phi(p)} +\valeur{u})$ avec $0\leq p\leq q\leq h$ et en notant $u=a_{\phi(p)+1}\cdots a_{\phi(q)}$, 
%cela donne $\vect{x}_{\phi(p)} \rel_S (\vect{x}_{\phi(p)} +\valeur{u})$, d'où
alors on aurait $(\vect{x}_{\phi(p)} +\valeur{u^r}) \rel_S (\vect{x}_{\phi(p)} +\valeur{u^{r+1}})$ pour tout $r\in\N$ (en procédant par récurrence sur $r$ avec la proposition \ref{Monotonie relation}).

Or $\valeur{u^r}(i) = r\times\valeur{u}(i) = r\times (\vect{x}_{\phi(q)}(i) -\vect{x}_{\phi(p)}(i)) < -r$, 
ce qui prouve que $(\vect{x}_{\phi(p)} +\valeur{u^r})(i)<0$ à partir d'un certain $r\in\N$, 
et donc $(\vect{x}_{\phi(p)} +\valeur{u^r}) \not\rel_S \vect{x}_{\phi(p)}$, d'où une contradiction.

On conclut qu'il existe au moins $k/\xi$ classes d'équivalences pour $\rel_S$ (et ce pour tout $k\in\N$), 
ainsi $\reach(S)/\rel_S$ est infini.
\end{proof}

%\textbf{Méthode de Valk et Vidal-Naquet :}

%On prouve d'abord la réciproque en construisant un automate fini reconnaissant $\lang(S)$.
%Pour cela, on restreint simplement les états aux configurations de $\os{0,\dots,c}^d$ pour une certaine constante $c\in\N$ obtenue à partir de $k$.
%L'autre sens est montré par l'absurde, en s'appuyant sur les circuits dans le graphe de couverture de $S$.

\section{Décider la caractérisation}

La procédure de décision nécessite de connaître deux choses :
\begin{enumerate}
    \item D'abord, on veut pouvoir accéder à la liste des idéaux maximaux $\clover(S)$ du VAS étudié,
    \item Ensuite, il nous faut une procédure pour décider si un VAS donné est bornées.
\end{enumerate}

\begin{Lemma}[\cite{giyo80} lemme 3]\label{mot décroissant}
    Soit $S=(A,\xinit)$ un VAS et $k\in\N$.
    Supposons qu'il existe une configuration $\vect{x}\in \reach(S)$ et un mot $v\in\lang(A,\vect{x})$ franchissable tel que $\valeur{v}(i) < -k$ pour un certain $i \in I$.
    Alors on peut trouver une autre configuration $\vect{y}$ et un autre mot $w\in\lang(A,\vect{y})$ tel que $\valeur{w}(i) < -k$ et $\valeur{u}(i) \leq 0$ pour tout préfixe $u$ de $w$.
\end{Lemma}

\begin{proof}
Notons $z$ le plus long préfixe de $v$ tel que $\valeur{z}(i) \geq 0$.
On a alors $v = zw$, et le mot $w$ ainsi obtenu est franchissable à partir de $\vect{y} = \vect{x} + \valeur{z}$, 
et vérifie $\valeur{w}(i) = \valeur{v}(i) - \valeur{z}(i) \leq \valeur{v}(i) \leq k$.
De plus, pour tout préfixe $u$ de $w$, on a $\valeur{u}(i) = \valeur{zu}(i) - \valeur{z}(i) \leq \valeur{zu}(i) < 0$ puisque $zu$ est un préfixe de $v$ plus long que $z$.
\end{proof}

\begin{Definition}
Soit $S=(A,\xinit)$ un $d-$VAS.
Pour tout idéal maximal $\mathfrak{m}\in\clover(S)$ de l'ensemble de couverture, notons $J_\mathfrak{m} \defeq \set{j}{\mathfrak{m}(j)\neq \omega}$ l'ensemble des coordonnées bornées pour les configurations de $\mathfrak{m}$.
On écrit $J_\mathfrak{m}=\os{j_1,\dots,j_r}$.

Pour tout $i\notin J_\mathfrak{m}$, on définit un $(r+1)-$VAS $S(\mathfrak{m},i) = \big(A(\mathfrak{m},i), \vect{x}_\mathfrak{m}\big)$ en posant
\begin{itemize}
    \item $A(\mathfrak{m},i) \defeq \set{a(\mathfrak{m},i)} {a\in A}$ 
    les actions étiquetées par $\valeur{a(\mathfrak{m},i)} \defeq \big(\valeur{a}(j_1), \dots, \valeur{a}(j_r), -\valeur{a}(i) \big)$,
    \item $\vect{x}_\mathfrak{m} \defeq \big(\mathfrak{m}(j_1), \dots, \mathfrak{m}(j_r), 0\big) \in \N^{r+1}$ la configuration initiale.
\end{itemize}
\end{Definition}

\noindent On regarde ainsi le comportement de chaque coordonnée non-bornée indépendamment des autres.

On étend la correspondance entre les actions de $S$ et celles de $S(\mathfrak{m},i)$ aux mots : 
pour $w = a_1\cdots a_n \in A^\ast$, on pose $w(\mathfrak{m},i) \defeq a_1(\mathfrak{m},i) \cdots a_n(\mathfrak{m},i) \in A(\mathfrak{m},i)^\ast$.

Le théorème suivant est alors obtenu :

\begin{Theorem}[\cite{giyo80} théorème 2]
    Soit $S=(A,\xinit)$ un $d-$VAS.
    Alors $S$ est rationnel si et seulement si 
    tous les VAS $S(\mathfrak{m},i)$ sont bornés pour tout idéal maximal $\mathfrak{m} \in \clover(S)$ et tout $i \in I \setminus J_\mathfrak{m}$.
\end{Theorem}

\begin{proof}
Supposons que l'un des $S(\mathfrak{m},i)$ ne soit pas borné, et posons $r = \card{J_\mathfrak{m}}$.
La coordonnée $r+1$ (associée à $\mathfrak{m}(i)$) est la seule à pouvoir être non-bornée.
Pour tout $k\in\N$, il existe donc un mot $w(\mathfrak{m},i) \in \lang(S(\mathfrak{m},i))$ vérifiant $\valeur{w(\mathfrak{m},i)}(r+1) >k$.

Alors on peut trouver une configuration $\vect{x}\in\reach(S)$ de $\mathfrak{m}$ telle que $w\in\lang(A,\vect{x})$.
En effet, $w$ a le même effet sur les coordonnées $j_p \in J_\mathfrak{m}$ que $w(\mathfrak{m},i)$ sur $p\leq r$,
puisque pour tout $x\in\reach(S)$ et tout préfixe $u$ de $w$, on a
$(\vect{x} +\valeur{u})(j_p) = 
\mathfrak{m}(j_p) +\valeur{u}(j_p) = 
%(\vect{x}(\mathfrak{m},i) +\valeur{u(\mathfrak{m},i)})(p) = 
%\mathfrak{m}(j_p) +\valeur{u(\mathfrak{m},i)})(p) = 
\vect{x}_\mathfrak{m}(p) +\valeur{u(\mathfrak{m},i)})(p) \geq 0$.
Les autres coordonnées (non-bornées dans $\mathfrak{m}$) peuvent ensuite être choisies aussi grandes que nécessaire pour franchir $w$.

Comme $\valeur{w}(i) = -\valeur{w(\mathfrak{m},i)}(r+1) < -k$, on sait que $S$ ne vérifie pas \eqref{eq:caracterisation} pour ce $k$, 
ce qui assure que $\lang(S)$ n'est pas rationnel (par le théorème \ref{caractérisation}).

%----Réciproque
\vspace{3mm}
On suppose maintenant qu'il existe $k\in\N$ majorant les coordonnées de toutes les configurations accessibles de tous les $S(\mathfrak{m},i)$.
Par l'absurde, supposons que la propriété \eqref{eq:caracterisation} n'est pas vérifiée pour ce $k$.
Par le lemme \ref{mot décroissant}, il existe une coordonnée $i\leq d$, une configuration $\vect{y}$ et un mot $w\in \lang(A,\vect{y})$ tel que  $\valeur{w}(i) < -k$ et $\valeur{u}(i) \leq 0$ pour tout préfixe $u$ de $w$.

Soit $\mathfrak{m} \in\clover(S)$ un élément maximal contenant $\vect{y}$.
Alors il existe une configuration $\vect{z}\in\mathfrak{m}$ vérifiant $\vect{y} \leq \vect{z}$.
Dans le VAS $S(\mathfrak{m},i)$, le mot $w(\mathfrak{m},i)$ appartient au langage $\lang(S(\mathfrak{m},i))$ 
puisque pour tout préfixe $u(\mathfrak{m},i)$ de $w(\mathfrak{m},i)$, on a 
\begin{itemize}
    \item $(\vect{x}_\mathfrak{m} +\valeur{u (\mathfrak{m},i)} )(p) = (\vect{z} +\valeur{u})(j_p) \geq (\vect{y} +\valeur{u})(j_p) \geq 0$ pour tout $p$ car $u$ est franchissable sur $\vect{y}$,
    \item $(\vect{x}_\mathfrak{m} +\valeur{u (\mathfrak{m},i)} )(r+1) = -\valeur{u}(i) \geq 0$ où $r = \card{J_\mathfrak{m}}$.
\end{itemize}
Néanmoins, la configuration accessible $(\vect{x}_\mathfrak{m} + \valeur{w(\mathfrak{m},i)}) \in \reach(S(\mathfrak{m},i))$ contredit l'hypothèse de borne puisque $\valeur{w(\mathfrak{m},i)}(r+1) = -\valeur{w}(i) > k$.

\end{proof}

%--------------------------------------------------

\section{Rationalité structurelle}

Dans cette partie, les VAS n'auront pas de configuration initiale fixée.


\begin{Definition}
Pour un VAS $A$, on note  
%l'ensemble de configurations $\set{\vect{x}}{\lang(A,\vect{x}) \text{ n'est pas rationnel}}$ 
$R_A=Min \set{\vect{x}} {\lang(A,\vect{x}) \notin Rat}$ .
\end{Definition}

Commençons par énoncer une propriété de monotonie de la non-rationalité.
%\xout{selon les configurations initiales choisies.}

\begin{Proposition}\label{monotonie_rationnel}
Pour tout $d-$VAS $A$, 
%(sans configuration initiale).
%\alain{on va simplement noter $A$ un VAS sans configuration initiale}
l'ensemble de configurations $\set{\vect{x}}{\lang(A,\vect{x}) \text{ n'est pas rationnel}}$  est clos par le haut et donc $R_A$ est fini.


\end{Proposition}
%\alain{peut-on déduire que $\set{\vect{x}}{\lang(A,\vect{x}) \text{ est  rationnel}}$ est clos par le bas ?}
%\lucas{Oui, c'est le complémentaire.}

\begin{proof}
Soit $\vect{x},\vect{x'}\in\N^d$ deux configurations vérifiant $\vect{x} \leq \vect{x'}$.
Supposons que $\lang(A,\vect{x})$ ne soit pas rationnel.

D'après le théorème \ref{caractérisation}, il existe pour tout $k\in\N$ une exécution $\vect{x} \trans{u}{S} \vect{y}_k \trans{v}{S} \vect{z}_k$ vérifiant $\valeur{v} = \vect{z}_k - \vect{y}_k \not\geq -k$.
Comme $\vect{x}\leq\vect{x'}$, du fait de la monotonie des VAS, la séquence $uv$ est aussi franchissable à partir de $\vect{x'}$, et l'on obtient l'exécution $\vect{x'} \trans{u}{S} \vect{y'}_k \trans{v}{S} \vect{z'}_k$.
où $\vect{y'}_k = \vect{y}_k + (\vect{x'} - \vect{x})$ et $\vect{z'}_k = \vect{z}_k + (\vect{x'} - \vect{x})$.

On a alors $\vect{z'}_k - \vect{y'}_k = \valeur{v} \not\geq -k$, donc $(A,\vect{x'})$ ne satisfait pas non plus la propriété $\eqref{eq:caracterisation}$.
On en déduit que $\lang(A,\vect{x'})$ n'est pas rationnel.
\end{proof}

\alain{du coup on sait que $Min\{\vect{x}; \lang(A,\vect{x}) \notin Rat\}$ est fini. Montrons qu'il est calculable. Pour cela on applique un autre résultat de Valk qui caractérise les ensembles $K \subseteq \N^d$ clos par haut "calculables" ssi pour tout $x \in \N_{\omega}^d$ le prédicat suivant $P_K(\vect{x})=(\downarrow \vect{x} \cap \N^d \cap K \neq \emptyset)$ est décidable, je t'envoie le papier sur skype \cite{ValkJ85}}


\begin{Proposition}\label{minimaux}
L'ensemble $R_A$ est calculable pour tout $d-$VAS $A$.\alain{rapprocher le "d" du "VAS"}
\end{Proposition}

\begin{proof}
à faire
\end{proof}

\begin{Definition}
On dit qu'un $d-$VAS $A$ est \emph{structurellement rationnel} lorsque $R_A=\emptyset$  
%		$\lang(A,\vect{x})$ %(ou $(A,\vect{x})$ ?)  est rationnel pour tout  $\vect{x}\in\N^d$.
\end{Definition}

Pour $\vect{x},\vect{y}\in\Z^d$ (pas forcément positifs), on note $\vect{x} \transZ{u} \vect{y}$ pour $u\in A^*$ lorsque $\vect{y} = \vect{x} + \valeur{u}$.
Il s'agit ici d'une simple égalité vectorielle dans $\Z^d$, sans notion de franchissement (on pourra parler de $\Z$-VAS).
On écrira $\vect{x} \transZ{*} \vect{y}$ quand il existe $u\in A^*$ tel que $\vect{x} \transZ{u} \vect{y}$ .

Valk et Vidal-Naquet proposent une caractérisation pour la propriété de rationalité structurelle.

\begin{Theorem}[\cite{vavi81} théorème 6]
Un $d-$VAS $S=(A)$ n'est pas structurellement rationnel si et seulement s'il existe $\vect{x}_1, \vect{x}_2, \vect{x}_3, \vect{x}_4 \in \Z^d$ tels que 
\begin{enumerate}
    \item $\vect{x}_1 < \vect{x}_2$
    \item Pour tout $i \in I$, $\vect{x}_1(i) = \vect{x}_2(i)$ implique $\vect{x}_3(i) \leq \vect{x}_4(i)$,
    \item Il existe un $i\in I$ tel que $\vect{x}_3(i) > \vect{x}_4(i)$.
    
    \item $\vect{0} \transZ{*} \vect{x}_1 \transZ{*} \vect{x}_2 \transZ{*} \vect{x}_3 \transZ{*} \vect{x}_4$,
\end{enumerate}
\end{Theorem}

Lister les configurations rencontrés comme dans le point 4 ci-dessus est inutile pour la rationalité structurelle, puisqu'on peut augmenter au besoin la configuration initiale  pour permettre les étapes intermédiaires.
On propose ainsi une définition équivalente simplifiée avec des mots, dont on donnera une démonstration.

%---THM-STRUCT-RAT---

\begin{Theorem}\label{conf_struct_rat}
Un $d-$VAS $S=(A)$ n'est pas structurellement rationnel si et seulement s'il existe $u,v\in A^*$ tels que 
\begin{enumerate}
    \item $\valeur{u} > \vect{0}$,
    \item Pour tout $i \in I$, $\valeur{u}(i)=0$ implique $\valeur{v}(i) \geq 0$ ,
    \item Il existe $i\in I$ tel que $\valeur{v}(i) < 0$.
\end{enumerate}
\end{Theorem}

\begin{Remark}
Les propriétés des théorèmes 17 et 18 sont bien équivalentes :

\noindent À partir des configurations $\vect{x}_1, \vect{x}_2, \vect{x}_3, \vect{x}_4$, on choisit simplement pour $u$ le mot permettant d'aller de $\vect{x}_1$ à $\vect{x}_2$, et pour $v$ le mot allant de $\vect{x}_3$ à $\vect{x}_4$.

\noindent Dans l'autre sens, avec les mots $u,v$, on regarde simplement l'exécution $\vect{0} = \vect{x}_1 \transZ{u} \vect{x}_2 = \vect{x}_3 \transZ{v} \vect{x}_4$.
\end{Remark}

\begin{proof}
Supposons que $S$ ne soit pas structurellement rationnel.
Si $\lang(A,\xinit)$ n'est pas rationnel pour une configuration initiale $\xinit \in\N^d$, il existe (d'après le théorème \ref{caractérisation}) pour tout $k\in\N$ une séquence d'actions franchissable 
$\xinit \trans{u_k}{S} \vect{x}_k \trans{v_k}{S} \vect{y}_k$
et une coordonnée $i_k \in I$ tels que $\valeur{v_k}(i_k) \leq k$.

Remarquons qu'une séquence d'action qui convient pour un certain $k\in\N$ fonctionne aussi pour les valeurs de $k$ inférieures.
Par conséquent, on peut sélectionner uniquement les séquences qui nous intéresse, pour peu qu'il  en reste une infinité :

\begin{itemize}
    \item Comme $I$ est fini, les indices $i_k$ ne peuvent prendre qu'un nombre fini de valeurs possibles, donc (par le principe des tiroirs) il existe un $\iota\in I$ apparaissant une infinité de fois.
    On peut ainsi supposer que $i_k = \iota$ pour tout $k$.
    %\alain{expliquer même si ça semble évident}
    
    \item Comme $(\N^d,\leq)$ forme un bel ordre, la suite $(\valeur{u_k})_{k\in\N}$ admet une sous-suite croissante pour $\leq$.
    On peut donc se ramener au cas où $(\valeur{u_k})_{k\in\N}$ est croissante.
\end{itemize}

Notons $J\subseteq I$ l'ensemble des coordonnées bornées dans les $\valeur{u_k}$.
Formellement, on définit 
$$J = \set{j\in I}{\exists h_j\in\N, \forall k\in\N, \valeur{u_k}(j) \leq h_j}
\text{, et pour } j\in J,\hspace{2mm} h_j = \max \set{\valeur{u_k}(j)}{k\in\N}$$
\alain{on peut définir J = j tel que sup{(uk(j)/k} est fini }
Il nous faut maintenant définir des mots $u$ et $v$ vérifiant les trois points du théorème.
Commençons par fabriquer $u$ satisfaisant le point 1 :
\begin{itemize}
    \item Pour que les coordonnées dans $J$ des $\valeur{u_k}$ soient positives pour chaque $k\in\N$, 
    on construit $u_k'$ en retirant de $u_k$ pour tout $j\in J$ les $h_j$ premières actions qui font décroître la coordonnée $j$ (ou moins s'il n'y en a plus).
    On obtient ainsi $\valeur{u_k'}(j) \geq 0$ pour tout $k\in\N$ et $j\in J$.
    
    \item Posons $\xi = \set{\abs{\valeur{a}(i)}} {a\in A,i\in I}$.
    Lors du passage de $u_k$ à $u_k'$, les coordonnées $i\in I\setminus J$ ne peuvent décroître d'au plus $\xi \times \sum_{j\in J} h_j$.
    Par ailleurs, comme $(\valeur{u_k})_{k\in\N}$ est croissante et que pour tout $i\in I\setminus J$, la suite d'entiers $(\valeur{u_k}(i))_{k\in\N}$ tend vers l'infini, 
    il existe un $k_0\in\N$ tel que pour tout $i\in I\setminus J$, $\valeur{u_{k_0}}(i) > \xi \times \sum_{j\in J} h_j$.
    On en déduit que $\forall i\in I\setminus J, \hspace{1mm} \valeur{u_{k_0}}(i) > 0$.
\end{itemize}
Par conséquent, le mot $u_{k_0}'$ vérifie le point 1 %du théorème \ref{conf_struct_rat}
: $\valeur{u_{k_0}'} > \vect{0}$.
\vspace{2mm}

Maintenant, procédons de façon similaire sur les $v_k$.
Pour tout $j\in J$, $(\valeur{u_k}(j))_{k\in\N}$ est borné, donc $(\vect{x}_k(j))_{k\in\N}$ est borné également par $\ell_j = h_j + \xinit(j)$.
On construit alors $v_k'$ en retirant de $v_k$ pour tout $j\in J$ les $\ell_j$ premières actions qui font décroître la coordonnée $j$.
Tous les $v_k'$ vérifient le point 2 (avec $u = u_{k_0}'$), puisque si pour un $i\in I$, $\valeur{u_{k_0}'}(i) = 0$, alors $i\in J$, d'où $\valeur{v_k'}(i) \geq 0$.

Enfin, en prenant $k_1 = 1 + \xi \times \sum_{j\in J} \ell_j$, on a $\valeur{v_{k_1}}(\iota) \leq k_1$, d'où $\valeur{v_{k_1}'}(\iota) < 0$, et $v_{k_1}'$ vérifie aussi le point 3.
Finalement, $u_{k_0}'$ et $v_{k_1}'$ vérifient les trois points %du théorème \ref{conf_struct_rat}
, ce qui montre l'implication directe.
\vspace{5mm}

Réciproquement, supposons qu'il existe deux mots $u,v\in A^*$ vérifiant les points 1, 2, et 3.
Soit $\xinit$ une configuration sur laquelle $u$ est franchissable (on choisit des coordonnées aussi grandes que nécessaire).
Montrons que $\lang(A,\xinit)$ n'est pas rationnel.

Soit $k\in\N$.
Notons $\rho = \text{max}\set{-\valeur{v}(i)}{i\in I}$, 
et montrons alors que $u^{\rho\times k} v^k \in \lang(A,\xinit)$.

\begin{itemize}
    \item D'après le point 1, on a $\valeur{u} > \vect{0}$, donc $\xinit + \valeur{u} > \xinit$.
    Comme $u$ est franchissable sur $\xinit$, le mot $u^{\rho\times k}$ l'est également.
    Posons $\vect{x}_k = \xinit + \valeur{u^{\rho\times k}}$ la configuration atteinte.
    
    \item D'après le point 2, si pour un $i\in I$, on a $\valeur{v^k}(i) < 0$, alors $\valeur{u}(i) > 0$, d'où $\vect{x}_k(i) \geq \rho\times k$.
    Par définition de $\rho$, on en déduit que $\valeur{v^k}$ a bien les ressources nécessaires pour se déclencher sur $\vect{x}_k$, donc est bien franchissable.
    Posons $\vect{y}_k = \vect{x}_k + \valeur{v^k}$ la nouvelle configuration atteinte.
    
    \item Enfin, d'après le point 3, il existe un $i\in I$ tel que $\valeur{v}(i) < 0$, d'où $\valeur{v^k}(i) \leq -k$.
\end{itemize}
Par conséquent, l'exécution $\xinit \trans{u^{\rho\times k}}{S} \vect{x}_k \trans{v^k}{S} \vect{y}_k$ vérifie la propriété \eqref{eq:caracterisation} pour ce $k$.
On notera que $\xinit$ est bien indépendant de $k$.
Le langage $\lang(A,\xinit)$ n'est donc pas rationnel, et $S$ n'est pas structurellement rationnel.
\end{proof}

\begin{Proposition}
Problème de décision

Donnée : un ensemble de vecteurs $\mathfrak{A} \subseteq \Z^d$ (les étiquettes des actions de $A$).

Question : Existe-t-il deux vecteurs $\vect{u}$ et $\vect{v}$ obtenus comme combinaison semi-linéaire de $\mathfrak{A}$ vérifiant les 3 conditions suivantes:
\begin{enumerate}
    \item $\vect{u} > \vect{0}$,
    \item Pour tout $i \in I$, $\vect{u}(i)=0$ implique $\vect{v}(i) \geq 0$,
    \item  $\lnot(\vect{v} \geq 0)$.
\end{enumerate}

\end{Proposition}
\alain{C'est du Presburger existentiel sans autre quantificateur et c'est dans NP}
%==================================================

\section{Commentaires}
Vérifier qu'on peut énoncer Vidal-Naquet sur le graphe de couverture minimal défini par le graphe de Karp-Miller dans lequel on a gardé que les marquages maximaux.\\
Vérifier que ce nouveau graphe peut être obtenu à partir de Clover en ajoutant les transitions possibles (prolongées par continuité sur $\N^d$). Vérifier qu'il ne manque pas de transitions utiles.

Tenter de se débarrasser du graphe, de Clover, voire plus dans la preuve de Valk et Vidal-Naquet.

Simplifier le thm 12 pour avoir un calcul facile dans les cas faciles (borné).

Voir Garey, Johnson : référence pour les problèmes de complexité sur les vecteurs

Regarder taille de l'automate (minimal ?) construit par GY et VVN. Est-ce Ackermann ?

Regarder les propriétés de monotonie des VAS pour la rationalité : 
Augmenter la configuration initiale peut-il permettre de retrouver la rationalité ?
Voir ainsi si l'ensemble des configurations qui lorsque choisit initialement aboutissent à un VAS non-rationnel est clos par le haut.

Réduire la rationalité à la bornitude, la terminaison ou la couverture.

%================================================================

\begin{thebibliography}{10}

\bibitem{rasc59}
M. O. Rabin and D. Scott.
\newblock Finite Automata and Their Decision Problems.
\newblock {\em IBM Journal of Research and Development}, vol. 3, pages 114-125, 1959.

\bibitem{giyo80}
A. Ginzburg and M. Yoeli.
\newblock Vector Addition Systems and Regular Languages.
\newblock {\em Journal of Computer and System Science} 20, pages 277-284, 1980.

\bibitem{vavi81}
R. Valk and G. Vidal-Naquet.
\newblock Petri Nets and Regular Languages.
\newblock {\em Journal of Computer and System Science} 23, pages 299-325, 1981.

%@article{ValkJ85,
%  author    = {R{\"{u}}diger Valk and
%               Matthias Jantzen},
%  title     = {The Residue of Vector Sets with Applications to Decidability Problems
%               in Petri Nets},
%  journal   = {Acta Informatica},
%  volume    = {21},
%  pages     = {643--674},
%  year      = {1985},
%  url       = {https://doi.org/10.1007/BF00289715},
%  doi       = {10.1007/BF00289715},
%  timestamp = {Sun, 21 Jun 2020 17:38:18 +0200},
%  biburl    = {https://dblp.org/rec/journals/acta/ValkJ85.bib},
%  bibsource = {dblp computer science bibliography, https://dblp.org}
%


\end{thebibliography}

\end{document}